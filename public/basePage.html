<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spy Talk</title>
    <link rel="stylesheet" href="./styles/styles.css">
    <link rel="shortcut icon" href="./images/spyIcon.png" type="image/x-icon">
  </head>
  <body>
    <header>
      <a href="/basePage.html" title="reload"><img id="spyHome" src="./images/spyIcon.png" alt="Spy"></a>      
      <h1 align="center">Welcome to Spy Talk!</h1>
    </header>
    <main>

      <div>
        <form id="enterCode" action="#">
          <input type="text" placeholder="Enter Code" />
          <input type="submit">
        </form>
        or
        <span id="createWormhole">create wormhole</span>
      </div>

      <div id="wellcome">
        Session: 
        <span id="sessionsName"></span>
        <span id="clientChanging">Client/changing:</span> 
        <span id="sessionsClient">0</span>
        User ID: 
        <span id="user_id">0</span>
        <ul id="changeColor"></ul>
      </div>

      <table>
        <tr>
          <td>            
              <form id="createMessage" action="#">
                <textarea name="message" id="message" rows="5" cols="30"></textarea>
                <div>                  
                  <input id="getMessage" type="button" value="get message"><br>
                  <input type="submit">
              </form>            
          </td>
          <td></td>
        </tr>
      </table>
      <div id="tapeOfdialog"></div>
      <br>
      <input id="deleteChat" type="button" value="Delete Chat" style="cursor: pointer;">
      <br>
      <input id="deleteChannel" type="button" value="Delete Channel" style="cursor: pointer;" disabled>
      <label style="cursor: pointer;" for="checkChannel">Delete</label><input id="checkChannel" name="checkChannel" type="checkbox">
      
    </main>
    <footer></footer>
    <script src="./src/constants.js"></script>
    <script src="./src/main.js"></script>
     <script>
        let socket = null;

        function log(message) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            console.log(message);
        }

        function log1(message) {
            console.log(message);
        }

        function connectWebSocket() {
            const statusDiv = document.getElementById('status');
            
            try {
                log1('üîÑ Connecting to ws://localhost:3006...');
                // statusDiv.textContent = 'Status: Connecting...';
                
                socket = new WebSocket('ws://localhost:3006');
                
                socket.onopen = function(event) {
                    log1('‚úÖ WebSocket CONNECTED successfully!');
                    // statusDiv.textContent = 'Status: Connected';
                    // statusDiv.style.color = 'green';
                };
                
                socket.onmessage = function(event) {
                    log1('üì® Received: ' + event.data);
                };
                
                socket.onerror = function(error) {
                    log1('‚ùå WebSocket ERROR');
                    // statusDiv.textContent = 'Status: Error - check console';
                    // statusDiv.style.color = 'red';
                    console.error('WebSocket error details:', error);
                };
                
                socket.onclose = function(event) {
                    log1('üîå WebSocket CLOSED: ' + event.code + ' - ' + event.reason);
                    // statusDiv.textContent = 'Status: Disconnected';
                    // statusDiv.style.color = 'gray';
                };
                
            } catch (error) {
                log1('üí• Exception: ' + error.message);
                // statusDiv.textContent = 'Status: Failed - ' + error.message;
                // statusDiv.style.color = 'red';
            }
        }

        function sendMessage() {
            if (socket && socket.readyState === WebSocket.OPEN) {
                const message = 'Hello Server at ' + new Date().toLocaleTimeString();
                socket.send(message);
                log1('üì§ Sent: ' + message);
            } else {
                log1('‚ö†Ô∏è Cannot send - WebSocket not connected');
            }
        }

        // –ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = connectWebSocket;
    </script>
  </body>
</html>
